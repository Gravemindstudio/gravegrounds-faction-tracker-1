<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bone March - GraveGrounds Faction Tracker</title>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="app">
        <!-- Navigation -->
        <nav class="navbar">
            <div class="nav-container">
                <div class="nav-logo">
                    <a href="../index.html" style="text-decoration: none; color: inherit;">
                        <span>GraveGrounds</span>
                    </a>
                </div>
                <div class="nav-menu">
                    <a href="../index.html" class="nav-link" onclick="navigateToSection('home')">Home</a>
                    <a href="../index.html" class="nav-link active" onclick="navigateToSection('factions')">Factions</a>
                    <a href="../index.html" class="nav-link" onclick="navigateToSection('gallery')">Gallery</a>
                    <a href="../index.html" class="nav-link" onclick="navigateToSection('profile')">Profile</a>
                </div>
                <div class="nav-auth">
                    <button id="loginBtn" class="btn btn-outline">Login</button>
                    <button id="signupBtn" class="btn btn-primary">Sign Up</button>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Faction Hero Section -->
            <section class="faction-hero bone-march-hero" style="background-image: url('../Bone march backround.png'); background-size: cover; background-position: center; background-repeat: no-repeat;">
                <div class="container">
                    <div class="faction-hero-content">
                        <div class="faction-hero-info">
                            <div class="faction-icon-large bone-march">
                                <img src="../Faction Icons/Bone March.png" alt="Bone March Icon" style="width: 100%; height: 100%; object-fit: contain;">
                            </div>
                            <h1 class="faction-title">Bone March</h1>
                            <p class="faction-tagline">The Endless March of Death</p>
                            <div class="faction-stats-hero">
                                <div class="stat-item">
                                    <span class="stat-number" data-faction="bone-march" data-stat="members">0</span>
                                    <span class="stat-label">Members</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" data-faction="bone-march" data-stat="weekly">0</span>
                                    <span class="stat-label">This Week</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-number" data-faction="bone-march" data-stat="rank">#7</span>
                                    <span class="stat-label">Rank</span>
                                </div>
                            </div>
                            <div class="faction-actions">
                                <button class="btn btn-faction btn-bone-march btn-large">Join Bone March</button>
                                <button class="btn btn-outline btn-large" onclick="showFactionMembers('bone-march')">View Members</button>
                            </div>
                        </div>
                        <div class="faction-hero-visual">
                            <div class="faction-symbol">
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Faction Details -->
            <section class="faction-details">
                <div class="container">
                    <div class="details-grid">
                        <div class="detail-card bone-march">
                            <h3>Faction Lore</h3>
                            <p>The Bone March emerged when the First Necromancer's scream tore the Veil. From forgotten battlefields, bones remembered orders and discipline. They rose as marching columns - endless, unbreakable, unstoppable.</p>
                            <p>They do not march for victory. They march so they never must stop. Movement is existence. Stillness is death. Their legions cross mountains and mires, carve bone bridges over ravines, and tunnel through ruined hillsides, leaving behind undead cities and fortresses.</p>
                        </div>
                        
                        <div class="detail-card bone-march">
                            <h3>Abilities & Powers</h3>
                            <ul class="ability-list">
                                <li><strong>Endless March:</strong> Tireless legions that never stop moving</li>
                                <li><strong>Bone Harvesting:</strong> Collect and reforge all remains into new horrors</li>
                                <li><strong>Siege Warfare:</strong> Build bone trebuchets and ram beasts from corpses</li>
                                <li><strong>Undead Cities:</strong> Transform conquered lands into necropolises</li>
                                <li><strong>Military Discipline:</strong> Coordinate vast armies with strategic precision</li>
                            </ul>
                        </div>

                        <div class="detail-card bone-march">
                            <h3>Leadership</h3>
                            <div class="leader-info">
                                <div class="leader-avatar">
                                    <img src="../8 Faction Leaders/General Skarn.png" alt="General Skarn" style="width: 200px; height: 200px; object-fit: cover; border-radius: 12px;">
                                </div>
                                <div class="leader-details">
                                    <h4>General Skarn</h4>
                                    <p>The Gravefather, the first to rise when the Veil fell. His silent will pulls corpses into formation like gravity.</p>
                                    <span class="leader-title">The Gravefather</span>
                                </div>
                            </div>
                        </div>

                        <div class="detail-card bone-march">
                            <h3>Territory</h3>
                            <p>The Bone March leaves behind outposts, citadels, and undead cities wherever they pause. These necropolises are built from fused bone, scavenged iron, and debris from shattered villages. Each serves as a center of necromantic experimentation and ceaseless recruitment.</p>
                        </div>

                        <div class="detail-card bone-march">
                            <h3>Faction Philosophy</h3>
                            <p>"We do not march for victory. We march so we never must stop. Movement is existence. Stillness is death. Death had already betrayed us, so we march endlessly, building a kingdom of the dead with its own black politics and cruel hierarchies."</p>
                        </div>

                        <div class="detail-card bone-march">
                            <h3>Achievements</h3>
                            <div class="achievement-list">
                                <div class="achievement">
                                    <span>Largest Undead Army</span>
                                </div>
                                <div class="achievement">
                                    <span>Most Strategic Victories</span>
                                </div>
                                <div class="achievement">
                                    <span>Highest Member Retention</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Recent Members -->
            <section class="recent-members">
                <div class="container">
                    <h2 class="section-title">Recent Recruits</h2>
                    <div class="members-grid" id="recent-members-bone-march">
                        <!-- Live member data will be populated here -->
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="footer-content">
                    <div class="footer-section">
                        <h4>GraveGrounds</h4>
                        <p>Track your faction's power and build your necromancer identity.</p>
                    </div>
                    <div class="footer-section">
                        <h4>Quick Links</h4>
                        <ul>
                            <li><a href="../index.html#home">Home</a></li>
                            <li><a href="../index.html#factions">Factions</a></li>
                            <li><a href="../index.html#gallery">Gallery</a></li>
                            <li><a href="../index.html#profile">Profile</a></li>
                        </ul>
                    </div>
                    <div class="footer-section">
                        <h4>Connect</h4>
                        <div class="social-links">
                            <a href="#"><i class="fab fa-discord"></i></a>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                        </div>
                    </div>
                </div>
                <div class="footer-bottom">
                    <p>&copy; 2024 GraveGrounds. All rights reserved.</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modals -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <div class="auth-tabs">
                <button class="auth-tab active" data-tab="login">Login</button>
                <button class="auth-tab" data-tab="signup">Sign Up</button>
            </div>
            <div id="loginForm" class="auth-form active">
                <form>
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Login</button>
                </form>
            </div>
            <div id="signupForm" class="auth-form">
                <form>
                    <div class="form-group">
                        <label for="signupUsername">Username</label>
                        <input type="text" id="signupUsername" required>
                    </div>
                    <div class="form-group">
                        <label for="signupEmail">Email</label>
                        <input type="email" id="signupEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <input type="password" id="signupPassword" required>
                    </div>
                    <div class="form-group">
                        <label for="signupFaction">Choose Faction</label>
                        <select id="signupFaction" required>
                            <option value="">Select a faction...</option>
                            <option value="bone-march" selected>Bone March</option>
                            <option value="choir-silence">Choir of Silence</option>
                            <option value="cult-withered-flame">Cult of the Withered Flame</option>
                            <option value="gravewrought-court">Gravewrought Court</option>
                            <option value="swarm-mireborn">Swarm of the Mireborn</option>
                            <option value="dawnflame-order">DawnFlame Order</option>
                            <option value="hollowed-redeemed">Hollowed Redeemed</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Create Account</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Faction Members Modal -->
    <div id="factionMembersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="factionMembersTitle">Faction Members</h3>
                <button class="modal-close" id="closeFactionMembersModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <!-- Loading State -->
                <div class="loading-state" id="membersLoadingState" style="display: none;">
                    <div class="loading-spinner"></div>
                    <p>Loading faction members...</p>
                </div>
                
                <!-- No Members State -->
                <div class="no-results" id="noMembersState" style="display: none;">
                    <i class="fas fa-users"></i>
                    <h3>No members found</h3>
                    <p>This faction doesn't have any public members yet.</p>
                </div>
                
                <!-- Members Grid -->
                <div class="members-grid" id="factionMembersGrid">
                    <!-- Member cards will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script src="../script.js"></script>
    <script src="../faction-members.js"></script>
    <script>
        // API Configuration (shared with faction-members.js)
        // const API_BASE_URL = window.location.hostname === 'localhost' ? 'http://localhost:8080' : 'https://gravegrounds-faction-tracker-production.up.railway.app';
        
        // Function to fetch faction stats
        async function fetchFactionStats(factionName) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/factions/${factionName}/stats`);
                if (response.ok) {
                    const stats = await response.json();
                    updateFactionStats(factionName, stats);
                } else {
                    // If API fails, show zeros instead of random numbers
                    updateFactionStats(factionName, {
                        member_count: 0,
                        weekly_growth: 0,
                        rank: 7
                    });
                }
            } catch (error) {
                console.log('Using fallback stats for', factionName);
                // Fallback to zeros if API is not available
                updateFactionStats(factionName, {
                    member_count: 0,
                    weekly_growth: 0,
                    rank: 7
                });
            }
        }
        
        // Function to update the UI with faction stats
        function updateFactionStats(factionName, stats) {
            const membersElement = document.querySelector(`[data-faction="${factionName}"][data-stat="members"]`);
            const weeklyElement = document.querySelector(`[data-faction="${factionName}"][data-stat="weekly"]`);
            const rankElement = document.querySelector(`[data-faction="${factionName}"][data-stat="rank"]`);
            
            if (membersElement) {
                // Use the correct API response format
                const memberCount = stats.member_count || 0;
                membersElement.textContent = memberCount.toLocaleString();
            }
            if (weeklyElement) {
                // Use the correct API response format
                const weeklyGrowth = stats.weekly_growth || 0;
                weeklyElement.textContent = weeklyGrowth > 0 ? `+${weeklyGrowth}` : weeklyGrowth.toString();
            }
            if (rankElement) {
                // Calculate rank based on member count (this would need to be implemented properly)
                const rank = stats.rank || 7;
                rankElement.textContent = `#${rank}`;
            }
        }
        
        function navigateToSection(section) {
            // Store the target section in localStorage
            localStorage.setItem('targetSection', section);
            // Navigate to the main page
            window.location.href = '../index.html';
        }
        
        // Initialize faction stats when page loads
        window.addEventListener('load', function() {
            // Fetch stats for this faction
            fetchFactionStats('bone-march');
            
            // Check if we need to scroll to a specific section after page load
            const targetSection = localStorage.getItem('targetSection');
            if (targetSection) {
                localStorage.removeItem('targetSection');
                // Small delay to ensure the page is fully loaded
                setTimeout(() => {
                    const section = document.querySelector(`#${targetSection}`);
                    if (section) {
                        const offsetTop = section.offsetTop - 80;
                        window.scrollTo({
                            top: offsetTop,
                            behavior: 'smooth'
                        });
                    }
                }, 100);
            }
        });
        
        // Listen for real-time updates from the main script
        if (typeof window.addEventListener === 'function') {
            window.addEventListener('factionUpdate', function(event) {
                const data = event.detail;
                if (data.faction === 'bone-march') {
                    // Update the stats immediately
                    updateFactionStats('bone-march', {
                        member_count: data.memberCount || 0,
                        weekly_growth: data.weeklyGrowth || 0,
                        rank: 1 // This will be recalculated on next fetch
                    });
                }
            });
        }
        

    </script>
</body>
</html>
